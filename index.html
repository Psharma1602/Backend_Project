<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SubmitHub | School Management System</title>
  <style>
    :root {
      --primary-blue: #0b2cff;
      --accent-orange: #ffb703;
      --text-dark: #333;
      --bg-light: #f6f8fc;
      --section-beige: #fff3e0;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Segoe UI", Tahoma, sans-serif; }
    body { background: #fff; color: var(--text-dark); overflow-x: hidden; }

    /* --- NAVIGATION --- */
    header {
      background: var(--primary-blue);
      padding: 15px 8%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .logo { color: #fff; font-size: 24px; font-weight: bold; cursor: pointer; }
    .logo span { color: var(--accent-orange); }
    nav { display: flex; align-items: center; gap: 20px; }
    nav a { color: #fff; text-decoration: none; font-weight: 500; font-size: 14px; }
    .btn-login { background: var(--accent-orange); border: none; padding: 8px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.3s; }
    .btn-login:hover { background: #e5a600; transform: translateY(-2px); }

    /* --- HERO SECTION --- */
    .hero {
      background: linear-gradient(135deg, var(--primary-blue) 0%, #1b5cff 100%);
      color: #fff;
      padding: 80px 8%;
      display: flex;
      align-items: center;
      min-height: 70vh;
    }
    .hero-content { flex: 1; max-width: 600px; }
    .hero-content h1 { font-size: 42px; line-height: 1.2; margin-bottom: 20px; }
    .hero-content h1 span { color: var(--accent-orange); }
    .hero-content p { font-size: 16px; opacity: 0.9; margin-bottom: 30px; line-height: 1.6; }
    .hero-image { flex: 1; text-align: right; }
    .hero-image img { width: 90%; max-width: 550px; border-radius: 10px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }

.clients { padding: 40px 8%; text-align: center; border-bottom: 1px solid #eee; }
    .clients h2 { font-size: 18px; color: #666; margin-bottom: 25px; }
    .logo-grid { display: flex; justify-content: center; gap: 50px; flex-wrap: wrap; opacity: 0.5; }
    .logo-grid img { height: 35px; filter: grayscale(1); }

    /* --- FEATURE ROW (Per Picture) --- */
    .feature-row { padding: 80px 8%; display: flex; align-items: center; gap: 60px; }
    .feature-text { flex: 1; }
    .feature-text h2 { color: var(--primary-blue); font-size: 32px; margin-bottom: 20px; }
    .feature-text h2 span { color: var(--accent-orange); }
    .feature-text p { color: #666; line-height: 1.8; margin-bottom: 20px; }
    .feature-img { flex: 1; position: relative; }
    /* --- DASHBOARD UI --- */
    #main-dashboard { display: none; padding: 40px 8%; background: var(--bg-light); min-height: 100vh; }
    .dashboard-card { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 30px; }
    .dashboard-card h2 { color: var(--primary-blue); margin-bottom: 20px; border-bottom: 2px solid var(--bg-light); padding-bottom: 10px; }
    
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th { text-align: left; background: #f8f9fa; padding: 15px; color: var(--primary-blue); font-size: 14px; text-transform: uppercase; }
    td { padding: 15px; border-bottom: 1px solid #eee; font-size: 14px; }
    
    .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
    .stat-box { background: var(--primary-blue); color: #fff; padding: 20px; border-radius: 10px; text-align: center; }
    .stat-box h3 { font-size: 24px; margin-top: 5px; }

    input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
    .btn-submit { background: var(--primary-blue); color: #fff; border: none; padding: 12px 30px; border-radius: 5px; cursor: pointer; font-weight: bold; }


    /* --- FOOTER --- */
footer {
  background: #0b2cff;
  color: #fff;
  padding: 50px 8% 20px;
  margin-top: 60px;
}

.footer-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 30px;
  margin-bottom: 30px;
}

.footer-brand h2 {
  font-size: 24px;
  margin-bottom: 10px;
}

.footer-brand span {
  color: var(--accent-orange);
}

.footer-brand p {
  font-size: 14px;
  opacity: 0.85;
  line-height: 1.6;
}

.footer-links h4,
.footer-contact h4 {
  margin-bottom: 15px;
  font-size: 16px;
}

.footer-links a {
  display: block;
  color: #fff;
  text-decoration: none;
  font-size: 14px;
  margin-bottom: 8px;
  opacity: 0.85;
}

.footer-links a:hover {
  opacity: 1;
  text-decoration: underline;
}

.footer-contact p {
  font-size: 14px;
  opacity: 0.85;
  margin-bottom: 8px;
}

.footer-bottom {
  border-top: 1px solid rgba(255,255,255,0.2);
  padding-top: 15px;
  text-align: center;
  font-size: 13px;
  opacity: 0.8;
}

  </style>
</head>
<body>

  <header>
    <div class="logo" onclick="location.reload()">Submit<span>Hub</span></div>
    <nav id="guest-nav">
      <button class="btn-login" onclick="window.location.href='login.html'">Login</button>
      <button class="btn-login" onclick="window.location.href='register.html'">Register</button>
    </nav>
    <nav id="user-nav" style="display:none;">
      <span id="role-tag" style="color: #fff; font-weight: bold; font-size: 12px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 20px;"></span>
      <button class="btn-login" id="logoutBtn">Logout</button>
    </nav>
  </header>

  <div id="welcome">
    <section class="hero">
      <div class="hero-content">
        <h1>Student Assignment Submission System <span>Optimize Your Efficiency</span></h1>
        <p>Manage assignments and track student progress seamlessly with SubmitHub.</p>
        <button class="btn-login" style="padding: 15px 40px;">Welcome</button>
      </div>
      <div class="hero-image">
        <img src="https://media.istockphoto.com/id/2149186896/vector/girl-working-on-laptop-vector-illustration-working-from-home-and-freelance-concept.jpg?s=612x612&w=0&k=20&c=JD3Lc9oJaBtF4loCBhfq_xitz8rQyJCN1u7xSQDyrtw=" alt="Dashboard Mockup">
      </div>
    </section>
    

    <section class="feature-row">
      <div class="feature-img">
        <img src="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=500" alt="Education">
      </div>
      <div class="feature-text">
        <h2>Top Online <span>School Management</span> Software for Efficient Operations</h2>
        <p>Our software recognizes the need for efficient school ERP systems. We provide a comprehensive solution for assignments, grading, and student tracking.</p>
        <button class="btn-login" style="background: var(--primary-blue); color:#fff;">Read More</button>
      </div>
    </section>
  </div>
  

  <main id="main-dashboard">
    <div id="studentDashboard" style="display:none;">
      <div class="stats-grid">
        <div class="stat-box">Total <h3 id="totalAssignments">0</h3></div>
        <div class="stat-box" style="background:#28a745">Submitted <h3 id="submittedAssignments">0</h3></div>
        <div class="stat-box" style="background:#ffc107">Pending <h3 id="pendingAssignments">0</h3></div>
      </div>
      <div class="dashboard-card">
        <h2>Your Assignments</h2>
        <table>
          <thead>
            <tr><th>Title</th><th>Due Date</th><th>Status</th><th>Grade</th></tr>
          </thead>
          <tbody id="assignmentTableBody"></tbody>
        </table>
      </div>
      <div class="dashboard-card">
        <h2>Submit Assignment</h2>
        <form id="submissionForm">
          <select id="assignmentSelect" required><option value="">--Select Assignment--</option></select>
          <input type="file" id="fileUpload" required>
          <textarea id="remarks" placeholder="Add any remarks..."></textarea>
          <button type="submit" class="btn-submit">Submit Assignment</button>
        </form>
      </div>
    </div>

    <div id="teacherDashboard" style="display:none;">
      <div class="dashboard-card">
        <h2>Create Assignment</h2>
        <form id="createAssignmentForm">
          <input type="text" id="newTitle" placeholder="Assignment Title" required>
          <textarea id="newDescription" placeholder="Description" required></textarea>
          <input type="date" id="newDueDate" required>
          <button type="submit" class="btn-submit">Publish</button>
        </form>
      </div>
      <div class="dashboard-card">
        <h2>Student Submissions</h2>
        <div id="teacherAssignments"></div>
      </div>
    </div>
  </main>

  <footer>
  <div class="footer-grid">
    
    <div class="footer-brand">
      <h2>Submit<span>Hub</span></h2>
      <p>
        SubmitHub is a modern school management system designed to simplify
        assignment handling, grading, and student progress tracking.
      </p>
    </div>

    <div class="footer-links">
      <h4>Quick Links</h4>
      <a href="index.html">Home</a>
      <a href="#">Features</a>
      <a href="login.html">Login</a>
      <a href="register.html">Register</a>
    </div>

    <div class="footer-links">
      <h4>For Users</h4>
      <a href="#">Students</a>
      <a href="#">Teachers</a>
      <a href="#">Dashboard</a>
      <a href="#">Assignments</a>
    </div>

    <div class="footer-contact">
      <h4>Contact</h4>
      <p>Email: support@submithub.com</p>
      <p>Phone: +91 98765 43210</p>
      <p>Location: India</p>
    </div>

  </div>

  <div class="footer-bottom">
    © 2025 SubmitHub | All Rights Reserved
  </div>
</footer>


  <script>
    const token = localStorage.getItem("token");
    const role = localStorage.getItem("role");

    function handleAccess() {
        if (!token || !role) {
            document.getElementById("welcome").style.display = "block";
            document.getElementById("main-dashboard").style.display = "none";
            document.getElementById("guest-nav").style.display = "flex";
            document.getElementById("user-nav").style.display = "none";
        } else {
            document.getElementById("welcome").style.display = "none";
            document.getElementById("main-dashboard").style.display = "block";
            document.getElementById("guest-nav").style.display = "none";
            document.getElementById("user-nav").style.display = "flex";
            document.getElementById("role-tag").innerText = role.toUpperCase();

            if (role === "student") {
                document.getElementById("studentDashboard").style.display = "block";
                fetchAssignments();
            } else if (role === "teacher") {
                document.getElementById("teacherDashboard").style.display = "block";
                fetchTeacherAssignments();
            }
        }
    }

    /* ---------------- STUDENT LOGIC 
     ---------------- */
    async function fetchAssignments() {
        try {
            const res = await fetch("http://localhost:3000/api/assignments", {
                headers: { "Authorization": `Bearer ${token}` }
            });
            const assignments = await res.json();
            const tableBody = document.getElementById("assignmentTableBody");
            const select = document.getElementById("assignmentSelect");
            
            tableBody.innerHTML = "";
            select.innerHTML = "<option value=''>--Select--</option>";

            let submittedCount = 0;
            assignments.forEach(a => {
                if (a.submitted) submittedCount++;
                select.innerHTML += `<option value="${a.id}">${a.title}</option>`;
                
                // Logic: Only show delete button if submitted AND NO GRADE exists
                const canDelete = a.submission_id && !a.grade;
                const deleteButton = canDelete ? 
                    `<br><button onclick="deleteMySubmission(${a.submission_id}, '${a.grade}')" style="color:red; cursor:pointer; background:none; border:none; text-decoration:underline; font-size:11px;">Delete</button>` 
                    : '';

                tableBody.innerHTML += `
                    <tr>
                        <td><b>${a.title}</b></td>
                        <td>${new Date(a.due_date).toLocaleDateString()}</td>
                        <td>
                            ${a.submitted ? '✅ Submitted' : '⏳ Pending'}
                            ${deleteButton}
                        </td>
                        <td>${a.grade || "---"}</td>
                    </tr>`;
            });

            document.getElementById("totalAssignments").innerText = assignments.length;
            document.getElementById("submittedAssignments").innerText = submittedCount;
            document.getElementById("pendingAssignments").innerText = assignments.length - submittedCount;
        } catch (err) { console.error(err); }
    }

    async function deleteMySubmission(id) {
    if (!confirm("Delete your submission?")) return;

    try {
        const res = await fetch(
            `http://localhost:3000/api/submissions/student/${id}`,
            {
                method: "DELETE",
                headers: { "Authorization": `Bearer ${token}` }
            }
        );

        const data = await res.json();

        if (!res.ok) {
            alert(data.message || "Cannot delete submission");
        } else {
            fetchAssignments();
        }
    } catch (err) {
        console.error(err);
    }
}


    /* ---------------- TEACHER LOGIC ---------------- */
    async function fetchTeacherAssignments() {
        try {
            const res = await fetch("http://localhost:3000/api/submissions/teacher/all", {
                headers: { "Authorization": `Bearer ${token}` }
            });
            const data = await res.json();
            const container = document.getElementById("teacherAssignments");
            container.innerHTML = "";

            data.forEach(a => {
                const subRows = a.submissions.map(s => {
                    const gradeText = s.grade ? "Update Grade" : "Grade";
                    const gradeDisplay = s.grade ? `<b style="color: green;">${s.grade}</b>` : "<i>Ungraded</i>";

                    return `
                        <tr>
                            <td>Student ID: ${s.student_id}</td>
                            <td><a href="http://localhost:3000/${s.file_path}" target="_blank">View File</a></td>
                            <td>${gradeDisplay}</td>
                            <td><button onclick="gradeSubmission(${s.id})">${gradeText}</button></td>
                            <td><button onclick="teacherDeleteSubmission(${s.id})" style="background:red; color:white; border:none; cursor:pointer; padding:5px 10px; border-radius:4px;">Remove</button></td>
                        </tr>`;
                }).join("");

                container.innerHTML += `
                    <div style="background:#fff; border:1px solid #ddd; padding:15px; margin-bottom:15px; border-radius:8px;">
                        <h3>${a.title} <button onclick="deleteAssignment(${a.id})" style="float:right; background:red; color:white; border:none; padding:5px; cursor:pointer;">Delete Assignment</button></h3>
                        <table>
                            <thead><tr><th>Student</th><th>File</th><th>Grade</th><th>Action</th><th>Delete</th></tr></thead>
                            <tbody>${subRows || '<tr><td colspan="5">No submissions</td></tr>'}</tbody>
                        </table>
                    </div>`;
            });
        } catch (err) { console.error(err); }
    }

    async function teacherDeleteSubmission(id) {
        if (!confirm("Remove this student's submission?")) return;
        try {
            const res = await fetch(`http://localhost:3000/api/submissions/teacher/${id}`, {
                method: "DELETE",
                headers: { "Authorization": `Bearer ${token}` }
            });
            if (res.ok) fetchTeacherAssignments();
        } catch (err) { console.error(err); }
    }

    async function deleteAssignment(id) {
        if (!confirm("Delete this assignment and all submissions?")) return;
        try {
            const res = await fetch(`http://localhost:3000/api/assignments/${id}`, {
                method: "DELETE",
                headers: { "Authorization": `Bearer ${token}` }
            });
            if (res.ok) fetchTeacherAssignments();
        } catch (err) { console.error(err); }
    }

    async function gradeSubmission(id) {
        const grade = prompt("Enter Grade:");
        if (!grade) return;
        try {
            const res = await fetch(`http://localhost:3000/api/submissions/${id}/grade`, {
                method: "PUT",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
                body: JSON.stringify({ grade })
            });
            if (res.ok) fetchTeacherAssignments();
        } catch (err) { console.error(err); }
    }

    /* ---------------- EVENTS ---------------- */
    document.getElementById("logoutBtn").addEventListener("click", () => {
        localStorage.clear();
        location.reload();
    });

    document.getElementById("createAssignmentForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const body = {
            title: document.getElementById("newTitle").value,
            description: document.getElementById("newDescription").value,
            due_date: document.getElementById("newDueDate").value
        };
        const res = await fetch("http://localhost:3000/api/assignments", {
            method: "POST",
            headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
            body: JSON.stringify(body)
        });
        if (res.ok) {
            alert("Published!");
            document.getElementById("createAssignmentForm").reset();
            fetchTeacherAssignments();
        }
    });

    document.getElementById("submissionForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData();
        formData.append("assignment_id", document.getElementById("assignmentSelect").value);
        formData.append("file", document.getElementById("fileUpload").files[0]);

        const res = await fetch("http://localhost:3000/api/submissions", {
            method: "POST",
            headers: { "Authorization": `Bearer ${token}` },
            body: formData
        });
        if (res.ok) {
            alert("Submitted!");
            fetchAssignments();
        }
    });

    handleAccess();
  </script>
</body>
</html>